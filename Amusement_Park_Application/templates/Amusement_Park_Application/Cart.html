{% extends 'common.html' %}
{% load static %}
{% load humanize %}
{% block disabled_cart %}style="pointer-events: none; opacity: 0.5;"{% endblock disabled_cart %}

{% block style %}
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<style>
		.form-label {
			display: block;
			font-size: 14px;
			font-weight: 600;
			color: #2c3e50;
			margin-bottom: 8px;
		}
		
		.bg-light-input {
			margin-bottom: 16px;
		}
		
		.form-control {
			width: 100%;
			padding: 10px;
			font-size: 14px;
			border: 1px solid #ced4da;
			border-radius: 6px;
			transition: border-color 0.3s ease;
		}
		
		.form-control:focus {
			border-color: #80bdff;
			box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
			outline: none;
		}
		
		select.form-control {
			appearance: none;
			background-color: #f8f9fa;
			border: 1px solid #ced4da;
			border-radius: 6px;
			padding: 8px 12px;
			font-size: 14px;
			cursor: pointer;
			width: 100%;
		}
		
		select.form-control:focus {
			border-color: #80bdff;
			box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
			outline: none;
		}	
		
		.hidden {
			display: none !important;
		}
				

	</style>



{% endblock style %}
	

{% block body %}


<!-- =======================
Page Banner START -->
<br><br>
<section class="py-0">
	<div class="container">
		{% comment %} <div class="row">
			{% comment %} <div class="col-12"> {% endcomment %}
				<div class="bg-light p-4 text-center rounded-3">
					<h1 class="m-0 fs-2">
						{% if request.language == 'fa' %}
							سبد خرید
						{% elif request.language == 'en' %}
							Shopping Cart
						{% elif request.language == 'ar' %}
							سلة التسوق
						{% endif %}
					</h1>
					<div class="d-flex justify-content-center">
						<nav aria-label="breadcrumb">
							<ol class="breadcrumb breadcrumb-dots mb-0">
								{% if request.language == 'fa' %}
									<li class="breadcrumb-item"><a href="{% url "Amusement_Park:Products" %}">صفحه اصلی</a></li>
									<li class="breadcrumb-item active" aria-current="page">سبد خرید</li>
								{% elif request.language == 'en' %}
									<li class="breadcrumb-item"><a href="{% url "Amusement_Park:Products" %}">Main page</a></li>
									<li class="breadcrumb-item active" aria-current="page">Cart</li>
								{% elif request.language == 'ar' %}
									<li class="breadcrumb-item"><a href="{% url "Amusement_Park:Products" %}">الصفحة الرئيسية</a></li>
									<li class="breadcrumb-item active" aria-current="page">سلة التسوّق</li>
								{% endif %}										
							</ol>
						</nav>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
<!-- =======================
Page Banner END -->

<!-- =======================
Page content START -->
<section class="pt-5-special">
	<div class="container">
	
		<div class="row g-4 g-sm-5">
			<!-- Main content START -->
			<div class="col-lg-8 mb-4 mb-sm-0">
				<div class="card card-body p-4 shadow">
					<div class="table-responsive border-0 rounded-3">
						<!-- Table START -->
						<table class="table align-middle p-4 mb-0">
							<!-- Table body START -->
							<tbody class="border-top-0">
								<!-- Table item -->
								{% for item in cart_items %}
									<tr data-ticket-product-id="{{ item.product.id }}">
										<td>
											<div class="d-lg-flex align-items-center">
												<div class="w-100px w-md-80px mb-2 mb-md-0">
													<img src="{{ item.product.image.url }}" class="rounded" alt="">
												</div>
												<h6 class="mb-0 ms-lg-3 mt-2 mt-lg-0">
													{% if request.language == 'fa' %}
														<a style="font-size: 75%;">{{ item.product.title }}</a>
													{% elif request.language == 'en' %}
														<a style="font-size: 75%;">{{ item.product.title_en }}</a>
													{% elif request.language == 'ar' %}
														<a style="font-size: 75%;">{{ item.product.title_ar }}</a>
													{% endif %}														
												</h6>
											</div>
										</td>
										<td class="text-center">
											<h5 class="text-success mb-0" style="font-size: 75%;">{{ item.product.price|intcomma:False|default_if_none:"0" }} 
													{% if request.language == 'fa' %}
													ریال
													{% elif request.language == 'en' %}
													Rial
													{% elif request.language == 'ar' %}
													ريال
													{% endif %}

											</h5>
										</td>
										<td>
											<div class="d-flex justify-content-between align-items-center">
												<button class="btn btn-success btn-sm" disabled><i class="bi bi-cart"></i></button>
												<button class="btn btn-outline-danger btn-sm" disabled onclick="increment(this)">+</button>
												<button class="btn btn-outline-primary btn-sm counter" disabled data-product-id="{{ item.product.id }}">{{ item.quantity }}</button>
												<button class="btn btn-outline-danger btn-sm" disabled onclick="decrement(this)">-</button>
											</div>
										</td>
									</tr>
								{% endfor %}
								<!-- Table item -->
							</tbody>
							<!-- Table body END -->
						</table>
						<!-- Table END -->
					</div>

					<!-- Title -->
					<br>
					<h5 class="mb-0">
						{% if request.language == 'fa' %}
							اطلاعات مشتری (اختیاری) :
						{% elif request.language == 'en' %}
							Customer Information (Optional):
						{% elif request.language == 'ar' %}
							معلومات الزبون (اختياري):
						{% endif %}
					</h5>
					<br>
					<label class="discount-label">
						{% if request.language == 'fa' %}
							با پر کردن این فرم از تخفیف‌های هیجان‌انگیز بهره‌مند شوید!
						{% elif request.language == 'en' %}
							Fill out this form to enjoy exciting discounts!
						{% elif request.language == 'ar' %}
							عبئ هذا النموذج للاستفادة من الخصومات المثيرة!
						{% endif %}
					</label>
					<form class="row g-3 mt-0" method="POST" action="{% url 'Amusement_Park:save_customer' %}" id="customer-form">
						{% csrf_token %}

						<div class="input-group mt-2">
							<input id="phoneInput" name="phone" class="form-control"
							{% if request.language == 'fa' %}
								placeholder="شماره تماس :"
								style="text-align: right; direction: rtl;"
							{% elif request.language == 'en' %}
								placeholder="Phone Number:"
								style="text-align: left; direction: ltr;"
							{% elif request.language == 'ar' %}
								placeholder="رقم الهاتف:"
								style="text-align: right; direction: rtl;"
							{% endif %} 
							type="text" maxlength="11" minlength="11" required>
							<button id="applyButton" type="button" class="btn btn-primary" disabled>
								{% if request.language == 'fa' %}
									اعمال
								{% elif request.language == 'en' %}
									Apply
								{% elif request.language == 'ar' %}
									تطبيق
								{% endif %}
							</button>
						</div>
					
						<div class="col-md-6 bg-light-input">
							<label for="firstName" class="form-label">
								{% if request.language == 'fa' %}
									نام :
								{% elif request.language == 'en' %}
									Name:
								{% elif request.language == 'ar' %}
									الاسم:
								{% endif %}
							</label>
							<input type="text" id="firstName" name="firstName" class="form-control" disabled>
						</div>
						
						<div class="col-md-6 bg-light-input">
							<label for="lastName" class="form-label">
								{% if request.language == 'fa' %}
									نام خانوادگی :
								{% elif request.language == 'en' %}
									Last Name:
								{% elif request.language == 'ar' %}
									اسم العائلة:
								{% endif %}
							</label>
							<input type="text" id="lastName" name="lastName" class="form-control" disabled>
						</div>
						<div class="col-md-4 bg-light-input">
							<label for="gender" class="form-label">
								{% if request.language == 'fa' %}
									جنسیت :
								{% elif request.language == 'en' %}
									Gender:
								{% elif request.language == 'ar' %}
									الجنس:
								{% endif %}
							</label>
							{% if request.language == 'fa' %}
								<select name="gender" id="gender" class="form-control" dir="rtl" disabled>
									<option value="" disabled selected></option>
									<option style="direction: rtl;" value="آقا">آقا</option>
									<option style="direction: rtl;" value="خانم">خانم</option>
								</select>
							{% elif request.language == 'en' %}
								<select name="gender" id="gender" class="form-control" dir="ltr" disabled>
									<option value="" disabled selected></option>
									<option style="direction: ltr;" value="male">Male</option>
									<option style="direction: ltr;" value="female">Female</option>
								</select>
							{% elif request.language == 'ar' %}
								<select name="gender" id="gender" class="form-control" dir="rtl" disabled>
									<option value="" disabled selected></option>
									<option style="direction: rtl;" value="ذكر">ذكر</option>
									<option style="direction: rtl;" value="أنثى">أنثى</option>
								</select>
							{% endif %}
						</div>
						
						<div class="col-md-4 bg-light-input"> 
							<label for="city" class="form-label">
								{% if request.language == 'fa' %}
									استان :
								{% elif request.language == 'en' %}
									Province:
								{% elif request.language == 'ar' %}
									المحافظة:
								{% endif %}
							</label>
							{% if request.language == 'fa' %}
  <select name="city" id="city" class="form-control" dir="rtl" disabled>
    <option value="" disabled selected></option>
    <option style="direction: rtl;" value="مازندران">مازندران</option>
    <option style="direction: rtl;" value="گلستان">گلستان</option>
    <option style="direction: rtl;" value="گیلان">گیلان</option>
    <option style="direction: rtl;" value="تهران">تهران</option>
    <option style="direction: rtl;" value="البرز">البرز</option>
    <option style="direction: rtl;" value="اردبیل">اردبیل</option>
    <option style="direction: rtl;" value="آذربایجان شرقی">آذربایجان شرقی</option>
    <option style="direction: rtl;" value="آذربایجان غربی">آذربایجان غربی</option>
    <option style="direction: rtl;" value="بوشهر">بوشهر</option>
    <option style="direction: rtl;" value="چهارمحال و بختیاری">چهارمحال و بختیاری</option>
    <option style="direction: rtl;" value="فارس">فارس</option>
    <option style="direction: rtl;" value="همدان">همدان</option>
    <option style="direction: rtl;" value="هرمزگان">هرمزگان</option>
    <option style="direction: rtl;" value="ایلام">ایلام</option>
    <option style="direction: rtl;" value="اصفهان">اصفهان</option>
    <option style="direction: rtl;" value="کرمان">کرمان</option>
    <option style="direction: rtl;" value="کرمانشاه">کرمانشاه</option>
    <option style="direction: rtl;" value="کهگیلویه و بویراحمد">کهگیلویه و بویراحمد</option>
    <option style="direction: rtl;" value="کردستان">کردستان</option>
    <option style="direction: rtl;" value="لرستان">لرستان</option>
    <option style="direction: rtl;" value="مرکزی">مرکزی</option>
    <option style="direction: rtl;" value="قزوین">قزوین</option>
    <option style="direction: rtl;" value="قم">قم</option>
    <option style="direction: rtl;" value="خراسان رضوی">خراسان رضوی</option>
    <option style="direction: rtl;" value="خراسان شمالی">خراسان شمالی</option>
    <option style="direction: rtl;" value="خراسان جنوبی">خراسان جنوبی</option>
    <option style="direction: rtl;" value="سمنان">سمنان</option>
    <option style="direction: rtl;" value="سیستان و بلوچستان">سیستان و بلوچستان</option>
    <option style="direction: rtl;" value="یزد">یزد</option>
    <option style="direction: rtl;" value="زنجان">زنجان</option>
    <option style="direction: rtl;" value="هیچکدام">هیچکدام</option>
  </select>
{% elif request.language == 'en' %}
  <select name="city" id="city" class="form-control" dir="ltr" disabled>
    <option value="" disabled selected></option>
    <option value="Mazandaran">Mazandaran</option>
    <option value="Gilan">Gilan</option>
    <option value="Golestan">Golestan</option>
    <option value="Tehran">Tehran</option>
    <option value="Alborz">Alborz</option>
    <option value="Ardabil">Ardabil</option>
    <option value="East Azerbaijan">East Azerbaijan</option>
    <option value="West Azerbaijan">West Azerbaijan</option>
    <option value="Bushehr">Bushehr</option>
    <option value="Chaharmahal and Bakhtiari">Chaharmahal and Bakhtiari</option>
    <option value="Fars">Fars</option>
    <option value="Hamedan">Hamedan</option>
    <option value="Hormozgan">Hormozgan</option>
    <option value="Ilam">Ilam</option>
    <option value="Isfahan">Isfahan</option>
    <option value="Kerman">Kerman</option>
    <option value="Kermanshah">Kermanshah</option>
    <option value="Kohgiluyeh and Boyer-Ahmad">Kohgiluyeh and Boyer-Ahmad</option>
    <option value="Kurdistan">Kurdistan</option>
    <option value="Lorestan">Lorestan</option>
    <option value="Markazi">Markazi</option>
    <option value="Qazvin">Qazvin</option>
    <option value="Qom">Qom</option>
    <option value="Razavi Khorasan">Razavi Khorasan</option>
    <option value="North Khorasan">North Khorasan</option>
    <option value="South Khorasan">South Khorasan</option>
    <option value="Semnan">Semnan</option>
    <option value="Sistan and Baluchestan">Sistan and Baluchestan</option>
    <option value="Yazd">Yazd</option>
    <option value="Zanjan">Zanjan</option>
    <option value="None">None</option>
  </select>
{% elif request.language == 'ar' %}
  <select name="city" id="city" class="form-control" dir="rtl" disabled>
    <option value="" disabled selected></option>
    <option style="direction: rtl;" value="مازندران">مازندران</option>
    <option style="direction: rtl;" value="گیلان">گیلان</option>
    <option style="direction: rtl;" value="گلستان">گلستان</option>
    <option style="direction: rtl;" value="تهران">تهران</option>
    <option style="direction: rtl;" value="البرز">البرز</option>
    <option style="direction: rtl;" value="اردبیل">اردبیل</option>
    <option style="direction: rtl;" value="آذربایجان شرقی">آذربایجان شرقی</option>
    <option style="direction: rtl;" value="آذربایجان غربی">آذربایجان غربی</option>
    <option style="direction: rtl;" value="بوشهر">بوشهر</option>
    <option style="direction: rtl;" value="چهارمحال و بختیاری">چهارمحال و بختیاری</option>
    <option style="direction: rtl;" value="فارس">فارس</option>
    <option style="direction: rtl;" value="همدان">همدان</option>
    <option style="direction: rtl;" value="هرمزگان">هرمزگان</option>
    <option style="direction: rtl;" value="ایلام">ایلام</option>
    <option style="direction: rtl;" value="اصفهان">اصفهان</option>
    <option style="direction: rtl;" value="کرمان">کرمان</option>
    <option style="direction: rtl;" value="کرمانشاه">کرمانشاه</option>
    <option style="direction: rtl;" value="کهگیلویه و بویراحمد">کهگیلویه و بویراحمد</option>
    <option style="direction: rtl;" value="کردستان">کردستان</option>
    <option style="direction: rtl;" value="لرستان">لرستان</option>
    <option style="direction: rtl;" value="مرکزی">مرکزی</option>
    <option style="direction: rtl;" value="قزوین">قزوین</option>
    <option style="direction: rtl;" value="قم">قم</option>
    <option style="direction: rtl;" value="خراسان رضوی">خراسان رضوی</option>
    <option style="direction: rtl;" value="خراسان شمالی">خراسان شمالی</option>
    <option style="direction: rtl;" value="خراسان جنوبی">خراسان جنوبی</option>
    <option style="direction: rtl;" value="سمنان">سمنان</option>
    <option style="direction: rtl;" value="سیستان و بلوچستان">سیستان و بلوچستان</option>
    <option style="direction: rtl;" value="یزد">یزد</option>
    <option style="direction: rtl;" value="زنجان">زنجان</option>
    <option style="direction: rtl;" value="لا شيء">لا شيء</option>
  </select>
{% endif %}

						</div>
						
						
						<div class="col-md-4 bg-light-input">
							<label for="country" class="form-label">
								{% if request.language == 'fa' %}
									کشور:
								{% elif request.language == 'en' %}
									Country:
								{% elif request.language == 'ar' %}
									البلد:
								{% endif %}
							</label>
							{% if request.language == 'fa' %}
  <select name="country" id="country" class="form-control" dir="rtl" disabled>
    <option value="" disabled selected></option>
    <option style="direction: rtl;" value="ایران">ایران</option>
    <option style="direction: rtl;" value="افغانستان">افغانستان</option>
    <option style="direction: rtl;" value="پاکستان">پاکستان</option>
    <option style="direction: rtl;" value="عراق">عراق</option>
    <option style="direction: rtl;" value="ترکیه">ترکیه</option>
    <option style="direction: rtl;" value="ارمنستان">ارمنستان</option>
    <option style="direction: rtl;" value="آذربایجان">آذربایجان</option>
    <option style="direction: rtl;" value="ترکمنستان">ترکمنستان</option>
    <option style="direction: rtl;" value="عربستان سعودی">عربستان سعودی</option>
    <option style="direction: rtl;" value="کویت">کویت</option>
    <option style="direction: rtl;" value="بحرین">بحرین</option>
    <option style="direction: rtl;" value="قطر">قطر</option>
    <option style="direction: rtl;" value="امارات متحده عربی">امارات متحده عربی</option>
    <option style="direction: rtl;" value="عمان">عمان</option>
    <option style="direction: rtl;" value="آلمان">آلمان</option>
    <option style="direction: rtl;" value="آمریکا">آمریکا</option>
    <option style="direction: rtl;" value="ایتالیا">ایتالیا</option>
    <option style="direction: rtl;" value="اسپانیا">اسپانیا</option>
    <option style="direction: rtl;" value="استرالیا">استرالیا</option>
    <option style="direction: rtl;" value="کانادا">کانادا</option>
    <option style="direction: rtl;" value="هیچکدام">هیچکدام</option>
  </select>
{% elif request.language == 'en' %}
  <select name="country" id="country" class="form-control" dir="ltr" disabled>
    <option value="" disabled selected></option>
    <option value="Iran">Iran</option>
    <option value="Afghanistan">Afghanistan</option>
    <option value="Pakistan">Pakistan</option>
    <option value="Iraq">Iraq</option>
    <option value="Turkey">Turkey</option>
    <option value="Armenia">Armenia</option>
    <option value="Azerbaijan">Azerbaijan</option>
    <option value="Turkmenistan">Turkmenistan</option>
    <option value="Saudi Arabia">Saudi Arabia</option>
    <option value="Kuwait">Kuwait</option>
    <option value="Bahrain">Bahrain</option>
    <option value="Qatar">Qatar</option>
    <option value="UAE">United Arab Emirates</option>
    <option value="Oman">Oman</option>
    <option value="Germany">Germany</option>
    <option value="USA">USA</option>
    <option value="Italy">Italy</option>
    <option value="Spain">Spain</option>
    <option value="Australia">Australia</option>
    <option value="Canada">Canada</option>
    <option value="None">None</option>
  </select>
{% elif request.language == 'ar' %}
  <select name="country" id="country" class="form-control" dir="rtl" disabled>
    <option value="" disabled selected></option>
    <option style="direction: rtl;" value="إيران">إيران</option>
    <option style="direction: rtl;" value="أفغانستان">أفغانستان</option>
    <option style="direction: rtl;" value="باكستان">باكستان</option>
    <option style="direction: rtl;" value="العراق">العراق</option>
    <option style="direction: rtl;" value="تركيا">تركيا</option>
    <option style="direction: rtl;" value="أرمينيا">أرمينيا</option>
    <option style="direction: rtl;" value="أذربيجان">أذربيجان</option>
    <option style="direction: rtl;" value="تركمانستان">تركمانستان</option>
    <option style="direction: rtl;" value="السعودية">السعودية</option>
    <option style="direction: rtl;" value="الكويت">الكويت</option>
    <option style="direction: rtl;" value="البحرين">البحرين</option>
    <option style="direction: rtl;" value="قطر">قطر</option>
    <option style="direction: rtl;" value="الإمارات العربية المتحدة">الإمارات العربية المتحدة</option>
    <option style="direction: rtl;" value="عمان">عمان</option>
    <option style="direction: rtl;" value="ألمانيا">ألمانيا</option>
    <option style="direction: rtl;" value="أمريكا">أمريكا</option>
    <option style="direction: rtl;" value="إيطاليا">إيطاليا</option>
    <option style="direction: rtl;" value="إسبانيا">إسبانيا</option>
    <option style="direction: rtl;" value="أستراليا">أستراليا</option>
    <option style="direction: rtl;" value="كندا">كندا</option>
    <option style="direction: rtl;" value="لا شيء">لا شيء</option>
  </select>
{% endif %}

						</div>

						<div class="col-md-4 bg-light-input">
							<label for="birthDay" class="form-label">
								{% if request.language == 'fa' %}
									روز تولد:
								{% elif request.language == 'en' %}
									Birthdate:
								{% elif request.language == 'ar' %}
									تاريخ الميلاد:
								{% endif %}
							</label>
							<select id="birthDay" name="birthDay" class="form-control" disabled>
								<option value="" disabled selected></option>
								<option value="01">1</option>
								<option value="02">2</option>
								<option value="03">3</option>
								<option value="04">4</option>
								<option value="05">5</option>
								<option value="06">6</option>
								<option value="07">7</option>
								<option value="08">8</option>
								<option value="09">9</option>
								<option value="10">10</option>
								<option value="11">11</option>
								<option value="12">12</option>
								<option value="13">13</option>
								<option value="14">14</option>
								<option value="15">15</option>
								<option value="16">16</option>
								<option value="17">17</option>
								<option value="18">18</option>
								<option value="19">19</option>
								<option value="20">20</option>
								<option value="21">21</option>
								<option value="22">22</option>
								<option value="23">23</option>
								<option value="24">24</option>
								<option value="25">25</option>
								<option value="26">26</option>
								<option value="27">27</option>
								<option value="28">28</option>
								<option value="29">29</option>
								<option value="30">30</option>
								<option value="31">31</option>
							</select>
						</div>
						
						<div class="col-md-4 bg-light-input">
							<label for="birthMonth" class="form-label">
								{% if request.language == 'fa' %}
									ماه تولد:
								{% elif request.language == 'en' %}
									Birth Month:
								{% elif request.language == 'ar' %}
									شهر الميلاد:
								{% endif %}
							</label>
							<select id="birthMonth" name="birthMonth" class="form-control" disabled>
								<option value="" disabled selected></option> <!-- Placeholder -->
								<option value="01">1</option>
								<option value="02">2</option>
								<option value="03">3</option>
								<option value="04">4</option>
								<option value="05">5</option>
								<option value="06">6</option>
								<option value="07">7</option>
								<option value="08">8</option>
								<option value="09">9</option>
								<option value="10">10</option>
								<option value="11">11</option>
								<option value="12">12</option>
							</select>
						</div>
						
						<div class="col-md-4 bg-light-input">
							<label for="birthYear" class="form-label">
								{% if request.language == 'fa' %}
									سال تولد:
								{% elif request.language == 'en' %}
									Birth Year:
								{% elif request.language == 'ar' %}
									سنة الميلاد:
								{% endif %}
							</label>
							<select id="birthYear" name="birthYear" class="form-control" disabled>
								<option value="" disabled selected></option>
							
								<!-- فارسی -->
								{% if request.language == 'fa' %}
								<option value="1401">1401</option>
								<option value="1400">1400</option>
								<option value="1399">1399</option>
								<option value="1398">1398</option>
								<option value="1397">1397</option>
								<option value="1396">1396</option>
								<option value="1395">1395</option>
								<option value="1394">1394</option>
								<option value="1393">1393</option>
								<option value="1392">1392</option>
								<option value="1391">1391</option>
								<option value="1390">1390</option>
								<option value="1389">1389</option>
								<option value="1388">1388</option>
								<option value="1387">1387</option>
								<option value="1386">1386</option>
								<option value="1385">1385</option>
								<option value="1384">1384</option>
								<option value="1383">1383</option>
								<option value="1382">1382</option>
								<option value="1381">1381</option>
								<option value="1380">1380</option>
								<option value="1379">1379</option>
								<option value="1378">1378</option>
								<option value="1377">1377</option>
								<option value="1376">1376</option>
								<option value="1375">1375</option>
								<option value="1374">1374</option>
								<option value="1373">1373</option>
								<option value="1372">1372</option>
								<option value="1371">1371</option>
								<option value="1370">1370</option>
								<option value="1369">1369</option>
								<option value="1368">1368</option>
								<option value="1367">1367</option>
								<option value="1366">1366</option>
								<option value="1365">1365</option>
								<option value="1364">1364</option>
								<option value="1363">1363</option>
								<option value="1362">1362</option>
								<option value="1361">1361</option>
								<option value="1360">1360</option>
								<option value="1359">1359</option>
								<option value="1358">1358</option>
								<option value="1357">1357</option>
								<option value="1356">1356</option>
								<option value="1355">1355</option>
								<option value="1354">1354</option>
								<option value="1353">1353</option>
								<option value="1352">1352</option>
								<option value="1351">1351</option>
								<option value="1350">1350</option>
								<option value="1349">1349</option>
								<option value="1348">1348</option>
								<option value="1347">1347</option>
								<option value="1346">1346</option>
								<option value="1345">1345</option>
								<option value="1344">1344</option>
								<option value="1343">1343</option>
								<option value="1342">1342</option>
								<option value="1341">1341</option>
								<option value="1340">1340</option>
								<option value="1339">1339</option>
								<option value="1338">1338</option>
								<option value="1337">1337</option>
								<option value="1336">1336</option>
								<option value="1335">1335</option>
								<option value="1334">1334</option>
								<option value="1333">1333</option>
								<option value="1332">1332</option>
								<option value="1331">1331</option>
								<option value="1330">1330</option>

								{% elif request.language == 'en' %}
								<option value="2025">2025</option>
								<option value="2024">2024</option>
								<option value="2023">2023</option>
								<option value="2022">2022</option>
								<option value="2021">2021</option>
								<option value="2020">2020</option>
								<option value="2019">2019</option>
								<option value="2018">2018</option>
								<option value="2017">2017</option>
								<option value="2016">2016</option>
								<option value="2015">2015</option>
								<option value="2014">2014</option>
								<option value="2013">2013</option>
								<option value="2012">2012</option>
								<option value="2011">2011</option>
								<option value="2010">2010</option>
								<option value="2009">2009</option>
								<option value="2008">2008</option>
								<option value="2007">2007</option>
								<option value="2006">2006</option>
								<option value="2005">2005</option>
								<option value="2004">2004</option>
								<option value="2003">2003</option>
								<option value="2002">2002</option>
								<option value="2001">2001</option>
								<option value="2000">2000</option>
								<option value="1999">1999</option>
								<option value="1998">1998</option>
								<option value="1997">1997</option>
								<option value="1996">1996</option>
								<option value="1995">1995</option>
								<option value="1994">1994</option>
								<option value="1993">1993</option>
								<option value="1992">1992</option>
								<option value="1991">1991</option>
								<option value="1990">1990</option>
								<option value="1989">1989</option>
								<option value="1988">1988</option>
								<option value="1987">1987</option>
								<option value="1986">1986</option>
								<option value="1985">1985</option>
								<option value="1984">1984</option>
								<option value="1983">1983</option>
								<option value="1982">1982</option>
								<option value="1981">1981</option>
								<option value="1980">1980</option>
								<option value="1979">1979</option>
								<option value="1978">1978</option>
								<option value="1977">1977</option>
								<option value="1976">1976</option>
								<option value="1975">1975</option>
								<option value="1974">1974</option>
								<option value="1973">1973</option>
								<option value="1972">1972</option>
								<option value="1971">1971</option>
								<option value="1970">1970</option>
								<option value="1969">1969</option>
								<option value="1968">1968</option>
								<option value="1967">1967</option>
								<option value="1966">1966</option>
								<option value="1965">1965</option>
								<option value="1964">1964</option>
								<option value="1963">1963</option>
								<option value="1962">1962</option>
								<option value="1961">1961</option>
								<option value="1960">1960</option>
								<option value="1959">1959</option>
								<option value="1958">1958</option>
								<option value="1957">1957</option>
								<option value="1956">1956</option>
								<option value="1955">1955</option>
								<option value="1954">1954</option>
								<option value="1953">1953</option>
								<option value="1952">1952</option>
								<option value="1951">1951</option>
								<option value="1950">1950</option>
								<option value="1949">1949</option>
								<option value="1948">1948</option>
								<option value="1947">1947</option>
								<option value="1946">1946</option>
								<option value="1945">1945</option>
								<option value="1944">1944</option>
								<option value="1943">1943</option>
								<option value="1942">1942</option>
								<option value="1941">1941</option>
								<option value="1940">1940</option>
								<option value="1939">1939</option>
								<option value="1938">1938</option>
								<option value="1937">1937</option>
								<option value="1936">1936</option>
								<option value="1935">1935</option>
								<option value="1934">1934</option>
								<option value="1933">1933</option>
								<option value="1932">1932</option>
								<option value="1931">1931</option>
								<option value="1930">1930</option>


								{% elif request.language == 'ar' %}
								<option value="1447">١٤٤٧ هـ</option>
								<option value="1446">١٤٤٦ هـ</option>
								<option value="1445">١٤٤٥ هـ</option>
								<option value="1444">١٤٤٤ هـ</option>
								<option value="1443">١٤٤٣ هـ</option>
								<option value="1442">١٤٤٢ هـ</option>
								<option value="1441">١٤٤١ هـ</option>
								<option value="1440">١٤٤٠ هـ</option>
								<option value="1439">١٤٣٩ هـ</option>
								<option value="1438">١٤٣٨ هـ</option>
								<option value="1437">١٤٣٧ هـ</option>
								<option value="1436">١٤٣٦ هـ</option>
								<option value="1435">١٤٣٥ هـ</option>
								<option value="1434">١٤٣٤ هـ</option>
								<option value="1433">١٤٣٣ هـ</option>
								<option value="1432">١٤٣٢ هـ</option>
								<option value="1431">١٤٣١ هـ</option>
								<option value="1430">١٤٣٠ هـ</option>
								<option value="1429">١٤٢٩ هـ</option>
								<option value="1428">١٤٢٨ هـ</option>
								<option value="1427">١٤٢٧ هـ</option>
								<option value="1426">١٤٢٦ هـ</option>
								<option value="1425">١٤٢٥ هـ</option>
								<option value="1424">١٤٢٤ هـ</option>
								<option value="1423">١٤٢٣ هـ</option>
								<option value="1422">١٤٢٢ هـ</option>
								<option value="1421">١٤٢١ هـ</option>
								<option value="1420">١٤٢٠ هـ</option>
								<option value="1419">١٤١٩ هـ</option>
								<option value="1418">١٤١٨ هـ</option>
								<option value="1417">١٤١٧ هـ</option>
								<option value="1416">١٤١٦ هـ</option>
								<option value="1415">١٤١٥ هـ</option>
								<option value="1414">١٤١٤ هـ</option>
								<option value="1413">١٤١٣ هـ</option>
								<option value="1412">١٤١٢ هـ</option>
								<option value="1411">١٤١١ هـ</option>
								<option value="1410">١٤١٠ هـ</option>
								<option value="1409">١٤٠٩ هـ</option>
								<option value="1408">١٤٠٨ هـ</option>
								<option value="1407">١٤٠٧ هـ</option>
								<option value="1406">١٤٠٦ هـ</option>
								<option value="1405">١٤٠٥ هـ</option>
								<option value="1404">١٤٠٤ هـ</option>
								<option value="1403">١٤٠٣ هـ</option>
								<option value="1402">١٤٠٢ هـ</option>
								<option value="1401">١٤٠١ هـ</option>
								<option value="1400">١٤٠٠ هـ</option>
								<option value="1399">١٣٩٩ هـ</option>
								<option value="1398">١٣٩٨ هـ</option>
								<option value="1397">١٣٩٧ هـ</option>
								<option value="1396">١٣٩٦ هـ</option>
								<option value="1395">١٣٩٥ هـ</option>
								<option value="1394">١٣٩٤ هـ</option>
								<option value="1393">١٣٩٣ هـ</option>
								<option value="1392">١٣٩٢ هـ</option>
								<option value="1391">١٣٩١ هـ</option>
								<option value="1390">١٣٩٠ هـ</option>
								<option value="1389">١٣٨٩ هـ</option>
								<option value="1388">١٣٨٨ هـ</option>
								<option value="1387">١٣٨٧ هـ</option>
								<option value="1386">١٣٨٦ هـ</option>
								<option value="1385">١٣٨٥ هـ</option>
								<option value="1384">١٣٨٤ هـ</option>
								<option value="1383">١٣٨٣ هـ</option>
								<option value="1382">١٣٨٢ هـ</option>
								<option value="1381">١٣٨١ هـ</option>
								<option value="1380">١٣٨٠ هـ</option>
								<option value="1379">١٣٧٩ هـ</option>
							{% endif %}
								</select>
								
							</select>
							
						</div>
					
						<div class="col-12 text-end p-0 position-relative">
							<button type="submit" class="btn btn-primary w-100 mb-0" disabled>
								{% if request.language == 'fa' %}
									ذخیره
								{% elif request.language == 'en' %}
									Save
								{% elif request.language == 'ar' %}
									حفظ
								{% endif %}
							</button>
							<br>
							<small class="text-danger position-absolute" style="bottom: -20px; right: 0;">
								<i class="fas fa-exclamation-triangle"></i> 
								{% if request.language == 'fa' %}
									لطفا اطلاعات را با دقت وارد کنید زیرا پس از ذخیره امکان تغییر آن وجود ندارد.
								{% elif request.language == 'en' %}
									Please enter the information carefully, as it cannot be changed after saving.
								{% elif request.language == 'ar' %}
									يرجى إدخال المعلومات بعناية حيث أنه لا يمكن تعديلها بعد الحفظ.
								{% endif %}
							</small>
							<br>
						</div>					
					</form>
					<br>
					<!-- Form END -->

					<!-- Coupon input and button -->
					<hr>
					<h5 class="mb-0">
						{% if request.language == 'fa' %}
							تخفیف:
						{% elif request.language == 'en' %}
							Discount:
						{% elif request.language == 'ar' %}
							خصم:
						{% endif %}
					</h5>

					<div class="row g-3 mt-2">
						<div class="col-12">
							<div class="input-group w-100">
								<input type="text" class="form-control discount-input" id="discount-code"
								{% if request.language == 'fa' %}
									placeholder="کد تخفیف:"
									style="text-align: right; direction: rtl;"
								{% elif request.language == 'en' %}
									placeholder="Discount Code:"
									style="text-align: left; direction: ltr;"
								{% elif request.language == 'ar' %}
									placeholder="رمز الخصم:"
									style="text-align: right; direction: rtl;"
								{% endif %} >
								<button class="btn btn-primary" id="btn-code" disabled>
									{% if request.language == 'fa' %}
										اعمال
									{% elif request.language == 'en' %}
										Apply
									{% elif request.language == 'ar' %}
										تطبيق
									{% endif %}
								</button>
							</div>
							<small id="tip-code" class="form-text text-muted" style="display: none;"></small>
						</div>
					</div>
					
					{% if request.user.is_superuser or request.user.is_staff %}
						
						<!-- Coupon input and button -->
						<div class="row g-3 mt-2">
							<div class="col-12">
								<div class="input-group w-100">
									<input class="form-control discount-input" id="discount-amount"
									{% if request.language == 'fa' %}
										placeholder="تخفیف با مبلغ:"
										style="text-align: right; direction: rtl;"
									{% elif request.language == 'en' %}
										placeholder="Discount (Amount):"
										style="text-align: left; direction: ltr;"
									{% elif request.language == 'ar' %}
										placeholder="الخصم (المبلغ):"
										style="text-align: right; direction: rtl;"
									{% endif %}>
									<button class="btn btn-primary" id="btn-amount" disabled>
									{% if request.language == 'fa' %}
										اعمال
									{% elif request.language == 'en' %}
										Apply
									{% elif request.language == 'ar' %}
										تطبيق
									{% endif %}
									</button>
								</div>
								<small id="tip-amount" class="form-text text-muted" style="display: none;"></small>
							</div>
						</div>
						
						<!-- Coupon input and button -->
						<div class="row g-3 mt-2">
							<div class="col-12">
								<div class="input-group w-100">
									<input class="form-control discount-input" id="discount-percent" 
									{% if request.language == 'fa' %}
										placeholder="تخفیف با درصد:"
										style="text-align: right; direction: rtl;"
									{% elif request.language == 'en' %}
										placeholder="Discount (Percentage):"
										style="text-align: left; direction: ltr;"
									{% elif request.language == 'ar' %}
										placeholder="الخصم (النسبة المئوية):"
										style="text-align: right; direction: rtl;"
									{% endif %}>
									<button class="btn btn-primary" id="btn-percent" disabled>
									{% if request.language == 'fa' %}
										اعمال
									{% elif request.language == 'en' %}
										Apply
									{% elif request.language == 'ar' %}
										تطبيق
									{% endif %}
									</button>
								</div>
								<small id="tip-percent" class="form-text text-muted" style="display: none;"></small>
							</div>
						</div>

					{% else %}

						<div class="row g-3 mt-2 hidden">
							<div class="col-12">
								<div class="input-group w-100">
									<input class="form-control discount-input" id="discount-amount"
									{% if request.language == 'fa' %}
										placeholder="تخفیف با مبلغ:"
										style="text-align: right; direction: rtl;"
									{% elif request.language == 'en' %}
										placeholder="Discount (Amount):"
										style="text-align: left; direction: ltr;"
									{% elif request.language == 'ar' %}
										placeholder="الخصم (المبلغ):"
										style="text-align: right; direction: rtl;"
									{% endif %}>
									<button class="btn btn-primary" id="btn-amount" disabled>
									{% if request.language == 'fa' %}
										اعمال
									{% elif request.language == 'en' %}
										Apply
									{% elif request.language == 'ar' %}
										تطبيق
									{% endif %}
									</button>
								</div>
								<small id="tip-amount" class="form-text text-muted" style="display: none;"></small>
							</div>
						</div>
						
						<div class="row g-3 mt-2 hidden">
							<div class="col-12">
								<div class="input-group w-100">
									<input class="form-control discount-input" id="discount-percent" 
									{% if request.language == 'fa' %}
										placeholder="تخفیف با درصد:"
										style="text-align: right; direction: rtl;"
									{% elif request.language == 'en' %}
										placeholder="Discount (Percentage):"
										style="text-align: left; direction: ltr;"
									{% elif request.language == 'ar' %}
										placeholder="الخصم (النسبة المئوية):"
										style="text-align: right; direction: rtl;"
									{% endif %}>
									<button class="btn btn-primary" id="btn-percent" disabled>
									{% if request.language == 'fa' %}
										اعمال
									{% elif request.language == 'en' %}
										Apply
									{% elif request.language == 'ar' %}
										تطبيق
									{% endif %}
									</button>
								</div>
								<small id="tip-percent" class="form-text text-muted" style="display: none;"></small>
							</div>
						</div>

					{% endif %}
					

					<!-- Title -->
					<hr>
					<div class="card card-body p-4 shadow">
						<h5 class="">
							{% if request.language == 'fa' %}
								روش‌های پرداخت:
							{% elif request.language == 'en' %}
								Payment Methods:
							{% elif request.language == 'ar' %}
								طرق الدفع:
							{% endif %}
						</h5>
						<br>
						<div class="col-12">
							<div class="accordion accordion-circle" id="accordioncircle">

								{% if request.user.is_superuser or request.user.is_staff %}

								<!-- Card reader (Default) -->
								<div class="accordion-item mb-3">
									<h6 class="accordion-header" id="heading-card-reader">
										<button class="accordion-button rounded" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-card-reader" aria-expanded="true" aria-controls="collapse-card-reader">
										{% if request.language == 'fa' %}
											دستگاه کارتخوان
										{% elif request.language == 'en' %}
											POS Terminal
										{% elif request.language == 'ar' %}
											جهاز نقاط البيع
										{% endif %}									
										</button>
									</h6>
									<div id="collapse-card-reader" class="accordion-collapse collapse show" aria-labelledby="heading-card-reader" data-bs-parent="#accordioncircle">
									</div>
								</div>

								<!-- Cash -->
								<div class="accordion-item mb-3">
									<h6 class="accordion-header" id="heading-cash">
										<button class="accordion-button collapsed rounded" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-cash" aria-expanded="false" aria-controls="collapse-cash">
											{% if request.language == 'fa' %}
												نقدی
											{% elif request.language == 'en' %}
												Cash
											{% elif request.language == 'ar' %}
												نقداً
											{% endif %}
										</button>
									</h6>
									<div id="collapse-cash" class="accordion-collapse collapse" aria-labelledby="heading-cash" data-bs-parent="#accordioncircle">
									</div>
								</div>

								<!-- Combined payment -->
								<div class="accordion-item mb-3">
									<h6 class="accordion-header" id="heading-combined">
										<button class="accordion-button collapsed rounded" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-combined" aria-expanded="false" aria-controls="collapse-combined">
											{% if request.language == 'fa' %}
												ترکیبی
											{% elif request.language == 'en' %}
												Combined
											{% elif request.language == 'ar' %}
												مُختلَط
											{% endif %}
										</button>
									</h6>
									<div id="collapse-combined" class="accordion-collapse collapse" aria-labelledby="heading-combined" data-bs-parent="#accordioncircle">
										<div class="accordion-body">
											<form class="row g-3">
												<div class="col-12">
													<label class="form-label"><span class="text-danger2">
														{% if request.language == 'fa' %}
															* مقدار مبلغ نقدی (ریال)
														{% elif request.language == 'en' %}
															* Cash Amount (Rial)
														{% elif request.language == 'ar' %}
															* مقدار المبلغ النقدي (ريال)
														{% endif %}
													</span></label>
													<input type="text" id="cash-amount" class="form-control" 
													{% if request.language == 'fa' %}
														placeholder="مبلغ نقدی:"
														style="text-align: right; direction: rtl;"
													{% elif request.language == 'en' %}
														placeholder="Cash Amount:"
														style="text-align: left; direction: ltr;"
													{% elif request.language == 'ar' %}
														placeholder="  المبلغ النقدي:"
														style="text-align: right; direction: rtl;"
													{% endif %}>
												</div>
												<div class="col-12">
													<label class="form-label"><span class="text-danger2">
														{% if request.language == 'fa' %}
															* مقدار مبلغ پرداخت با کارتخوان (ریال)
														{% elif request.language == 'en' %}
															* Amount paid by card reader (Rial)
														{% elif request.language == 'ar' %}
															* المبلغ المدفوع عبر جهاز الدفع (ريال)
														{% endif %}
													</span></label>
													<input type="text" id="card-amount" class="form-control" 
													{% if request.language == 'fa' %}
														placeholder="مبلغ کارتخوان :"
														style="text-align: right; direction: rtl;"
													{% elif request.language == 'en' %}
														placeholder="Card reader amount:"
														style="text-align: left; direction: ltr;"
													{% elif request.language == 'ar' %}
														placeholder="مبلغ جهاز الدفع:"
														style="text-align: right; direction: rtl;"
													{% endif %}>
												</div>
											</form>
											<br>
											<div class="row">
												<div class="col-12">
													<button type="button" id="apply-button" class="btn btn-primary w-100 mb-0" disabled>
														{% if request.language == 'fa' %}
															اعمال
														{% elif request.language == 'en' %}
															Apply
														{% elif request.language == 'ar' %}
															تطبيق
														{% endif %}
													</button>
												</div>
												<br>
												<br>
												<div class="col-12">
													<button type="button" id="reset-button" class="btn btn-danger w-100 mb-0" disabled>
														{% if request.language == 'fa' %}
															تلاش مجدد
														{% elif request.language == 'en' %}
															Try again
														{% elif request.language == 'ar' %}
															حاول مرة أخرى
														{% endif %}
													</button>
												</div>
											</div>
											<br>
										</div>
									</div>
								</div>

								{% else %}

								<!-- Card reader (Default) -->
								<div class="accordion-item mb-3">
									<h6 class="accordion-header" id="heading-card-reader">
										<button class="accordion-button rounded" type="button" style="pointer-events: none;">
										{% if request.language == 'fa' %}
											دستگاه کارتخوان
										{% elif request.language == 'en' %}
											POS Terminal
										{% elif request.language == 'ar' %}
											جهاز نقاط البيع
										{% endif %}		
										</button>
									</h6>
									<div id="collapse-card-reader" class="accordion-collapse collapse show" aria-labelledby="heading-card-reader" data-bs-parent="#accordioncircle">
									</div>
								</div>								

								<!-- Cash -->
								<div class="accordion-item mb-3 hidden">
									<h6 class="accordion-header" id="heading-cash">
										<button class="accordion-button collapsed rounded" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-cash" aria-expanded="false" aria-controls="collapse-cash">
											{% if request.language == 'fa' %}
												نقدی
											{% elif request.language == 'en' %}
												Cash
											{% elif request.language == 'ar' %}
												نقداً
											{% endif %}
										</button>
									</h6>
									<div id="collapse-cash" class="accordion-collapse collapse" aria-labelledby="heading-cash" data-bs-parent="#accordioncircle">
									</div>
								</div>

								<!-- Combined payment -->
								<div class="accordion-item mb-3 hidden">
									<h6 class="accordion-header" id="heading-combined">
										<button class="accordion-button collapsed rounded" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-combined" aria-expanded="false" aria-controls="collapse-combined">
											{% if request.language == 'fa' %}
												ترکیبی
											{% elif request.language == 'en' %}
												Combined
											{% elif request.language == 'ar' %}
												مُختلَط
											{% endif %}
									</button>
										</button>
									</h6>
									<div id="collapse-combined" class="accordion-collapse collapse" aria-labelledby="heading-combined" data-bs-parent="#accordioncircle">
										<div class="accordion-body">
											<form class="row g-3">
												<div class="col-12">
													<label class="form-label"><span class="text-danger2">
														{% if request.language == 'fa' %}
															* مقدار مبلغ نقدی (ریال)
														{% elif request.language == 'en' %}
															* Cash Amount (Rial)
														{% elif request.language == 'ar' %}
															* مقدار المبلغ النقدي (ريال)
														{% endif %}
													</span></label>
													<input type="text" id="cash-amount" class="form-control" 
													{% if request.language == 'fa' %}
														placeholder="مبلغ نقدی:"
														style="text-align: right; direction: rtl;"
													{% elif request.language == 'en' %}
														placeholder="Cash Amount:"
														style="text-align: left; direction: ltr;"
													{% elif request.language == 'ar' %}
														placeholder="  المبلغ النقدي:"
														style="text-align: right; direction: rtl;"
													{% endif %}>
												</div>
												<div class="col-12">
													<label class="form-label"><span class="text-danger2">
														{% if request.language == 'fa' %}
															* مقدار مبلغ پرداخت با کارتخوان (ریال)
														{% elif request.language == 'en' %}
															* Amount paid by card reader (Rial)
														{% elif request.language == 'ar' %}
															* المبلغ المدفوع عبر جهاز الدفع (ريال)
														{% endif %}
													</span></label>
													<input type="text" id="card-amount" class="form-control" 
													{% if request.language == 'fa' %}
														placeholder="مبلغ کارتخوان :"
														style="text-align: right; direction: rtl;"
													{% elif request.language == 'en' %}
														placeholder="Card reader amount:"
														style="text-align: left; direction: ltr;"
													{% elif request.language == 'ar' %}
														placeholder="مبلغ جهاز الدفع:"
														style="text-align: right; direction: rtl;"
													{% endif %}>
												</div>
											</form>
											<br>
											<div class="row">
												<div class="col-12">
													<button type="button" id="apply-button" class="btn btn-primary w-100 mb-0" disabled>
														{% if request.language == 'fa' %}
															اعمال
														{% elif request.language == 'en' %}
															Apply
														{% elif request.language == 'ar' %}
															تطبيق
														{% endif %}
													</button>
												</div>
												<br>
												<br>
												<div class="col-12">
													<button type="button" id="reset-button" class="btn btn-danger w-100 mb-0" disabled>
														{% if request.language == 'fa' %}
															تلاش مجدد
														{% elif request.language == 'en' %}
															Try again
														{% elif request.language == 'ar' %}
															حاول مرة أخرى
														{% endif %}
													</button>
												</div>
											</div>
											<br>
										</div>
									</div>
								</div>
								{% endif %}
								<!-- Credit or debit card END -->

								<!-- Net banking END -->
							</div>
						</div>
					</div>
					<!-- Payment method END -->
				</div>
			</div>
			<!-- Main content END -->

			<!-- Right sidebar START -->
			<div class="col-lg-4">
				<!-- Card total START -->
				<div class="card card-body p-4 shadow">
					<!-- Title -->
					<h4 class="mb-3 fs-5 text-center">
						{% if request.language == 'fa' %}
							صورت حساب
						{% elif request.language == 'en' %}
							Invoice
						{% elif request.language == 'ar' %}
							فاتورة
						{% endif %}
					</h4>
					<hr>

					<!-- Price and detail -->
					<ul class="list-group list-group-borderless mb-2">
						<li class="list-group-item px-0 d-flex justify-content-between">
							<span class="h6 fw-light mb-0">
								{% if request.language == 'fa' %}
									قیمت
								{% elif request.language == 'en' %}
									Price
								{% elif request.language == 'ar' %}
									السعر
								{% endif %}
							</span>
							<span class="h6 fw-light mb-0 fw-bold" id="item-total-price"> 
								{% if request.language == 'fa' %}
									ریال
								{% elif request.language == 'en' %}
									Rial
								{% elif request.language == 'ar' %}
									ريال
								{% endif %}
							</span> <!-- Dynamic price -->
						</li>
						<li class="list-group-item px-0 d-flex justify-content-between">
							<span class="h6 fw-light mb-0">
								{% if request.language == 'fa' %}
									مالیات
								{% elif request.language == 'en' %}
									Tax
								{% elif request.language == 'ar' %}
									ضريبة
								{% endif %}

								(%{{ get_TaxRate.rate|floatformat:0 }})
							</span>
							<span class="h6 fw-light mb-0 fw-bold" id="tax-amount">
								{% if request.language == 'fa' %}
									0 ریال
								{% elif request.language == 'en' %}
									0 Rial
								{% elif request.language == 'ar' %}
									0 ريال
								{% endif %}
							</span> <!-- Dynamic tax -->
						</li>
						<li class="list-group-item px-0 d-flex justify-content-between">
							<span class="h6 fw-light mb-0">
								{% if request.language == 'fa' %}
									تخفیف
								{% elif request.language == 'en' %}
									Discount
								{% elif request.language == 'ar' %}
									خصم
								{% endif %}
							</span>
							<span class="h6 fw-light mb-0 fw-bold"  id="discount-display">
								{% if request.language == 'fa' %}
									0 ریال
								{% elif request.language == 'en' %}
									0 Rial
								{% elif request.language == 'ar' %}
									0 ريال
								{% endif %}
							</span>
						</li>
						<br>
						<li class="list-group-item px-0 d-flex justify-content-between">
							<span class="h5 mb-0">
								{% if request.language == 'fa' %}
									قیمت نهایی
								{% elif request.language == 'en' %}
									Final Price
								{% elif request.language == 'ar' %}
									السعر النهائي
								{% endif %}

							</span>
							<span class="text-danger h5" id="final-price">
								{% if request.language == 'fa' %}
									0 ریال
								{% elif request.language == 'en' %}
									0 Rial
								{% elif request.language == 'ar' %}
									0 ريال
								{% endif %}
							</span>
						</li>
					</ul>
					<hr>

					<!-- Button -->
					<div class="d-grid">
						{% if cart_empty %}
							<a id="search" class="btn btn-lg btn-success disabled">
								{% if request.language == 'fa' %}
									پرداخت
								{% elif request.language == 'en' %}
									Payment
								{% elif request.language == 'ar' %}
									الدفع
								{% endif %}
							</a>
						{% else %}
							<a id="search" class="btn btn-lg btn-success">
								{% if request.language == 'fa' %}
									پرداخت
								{% elif request.language == 'en' %}
									Payment
								{% elif request.language == 'ar' %}
									الدفع
								{% endif %}
							</a>
						{% endif %}
						<a href='{% url "Amusement_Park:Products" %}' class="btn btn-lg btn-outline-danger">
							{% if request.language == 'fa' %}
								لغو
							{% elif request.language == 'en' %}
								Cancel
							{% elif request.language == 'ar' %}
								إلغاء
							{% endif %}
						</a>
					</div>
				</div>
				<!-- Card total END -->
			</div>
			<!-- Right sidebar END -->

		</div><!-- Row END -->
	</div>
</section>

<input style="display:none;" type="text" placeholder="URL" value="http://127.0.0.1:8080/pcpos" id="pcpos_url" />
<input style="display:none;" type="text" placeholder="Pr Code" value="000000" id="pr_code" />
<input type="text" placeholder="Amount" value="1234" id="amount" />
<input style="display:none;" type="text" placeholder="Currency" value="364" id="currency" />
<input style="display:none;" type="text" placeholder="Card Holder Reciept" id="r_cardholder" />
<input style="display:none;" type="text" placeholder="Card Holder Reciept" id="r3" />
<input style="display:none;" type="text" placeholder="Card Holder Reciept" id="r5" />
<input style="display:none;" type="text" placeholder="Card Holder Reciept" id="r7" />
<input style="display:none;" type="text" placeholder="Card Holder Reciept" id="r9" />
<input style="display:none;" type="text" placeholder="Merchant Reciept" id="r_merchant" />
<input style="display:none;" type="text" placeholder="Merchant Reciept" id="r4" />
<input style="display:none;" type="text" placeholder="Merchant Reciept" id="r6" />
<input style="display:none;" type="text" placeholder="Merchant Reciept" id="r8" />
<input style="display:none;" type="text" placeholder="Card Holder Title" id="t_cardholder" />
<input style="display:none;" type="text" placeholder="Merchant Title" id="t_merchant" />
<input style="display:none;" type="checkbox" id="chBox1" onclick="check1()" />
<input style="display:none;" type="text" placeholder="WareHoff1" value="9430324404128" id="WareHoff1" />
<input style="display:none;" type="text" placeholder="WareHoff2" value="40370492" id="WareHoff2" />
<input style="display:none;" type="checkbox" id="chBox2" onclick="check2()" />
<input style="display:none;" type="text" placeholder="Amount1" id="Amount1" />
<input style="display:none;" type="text" placeholder="IBAN1" id="IBAN1" />
<input style="display:none;" type="text" placeholder="ID1" id="ID1" />
<input style="display:none;" type="text" placeholder="Amount2" id="Amount2" />
<input style="display:none;" type="text" placeholder="IBAN2" id="IBAN2" />
<input style="display:none;" type="text" placeholder="ID2" id="ID2" />
<input style="display:none;" type="text" placeholder="Amount3" id="Amount3" />
<input style="display:none;" type="text" placeholder="IBAN3" id="IBAN3" />
<input style="display:none;" type="text" placeholder="ID3" id="ID3" />
<input style="display:none;" type="text" placeholder="Amount4" id="Amount4" />
<input style="display:none;" type="text" placeholder="IBAN4" id="IBAN4" />
<input style="display:none;" type="text" placeholder="ID4" id="ID4" />
<input style="display:none;" type="text" placeholder="Service" id="service" />
<input style="display:none;" type="text" placeholder="Service Group" id="service_group" />
<textarea style="display:none;" cols="40" rows="5" placeholder="Settelment" id="settelment"></textarea>
<textarea style="display:none;" cols="40" rows="5" placeholder="Key Value" id="key_value"></textarea>
<!-- =======================
Page content END -->
{% endblock body %}



{% block script %}
<script>
    // Function to increment the counter
    function increment(button) {
        const counter = button.parentElement.querySelector('.counter');
        let count = parseInt(counter.innerText, 10);
        counter.innerText = count + 1;
        updateTotalPrice(counter.dataset.productId, count + 1);
    }

    // Function to decrement the counter
    function decrement(button) {
        const counter = button.parentElement.querySelector('.counter');
        let count = parseInt(counter.innerText, 10);
        if (count > 0) {
            counter.innerText = count - 1;
            updateTotalPrice(counter.dataset.productId, count - 1);
        }
    }

    // Function to update the total price via AJAX
    function updateTotalPrice(productId, newQuantity) {
        fetch("{% url 'Amusement_Park:update_item_quantity' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}',
            },
            body: JSON.stringify({
                'product_id': productId,
                'quantity': newQuantity
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                fetchTotalPrice();
            }
        })
        .catch(error => {
            console.log('Error:', error);
        });
    }

    // Function to fetch and display the total price
	function fetchTotalPrice() {
		fetch("{% url 'Amusement_Park:calculate_total_price' %}")
		.then(response => response.json())
		.then(data => {
			// Update total price
			document.getElementById('item-total-price').innerText = data.total_price.toLocaleString() + ' ریال';
	
			// Update tax amount
			document.getElementById('tax-amount').innerText = data.tax.toLocaleString() + ' ریال';

			// Update final price
			updateFinalPrice();
		})
		.catch(error => {
			console.log('Error:', error);
		});
	}

    // Fetch the total price when the page loads
    document.addEventListener('DOMContentLoaded', fetchTotalPrice);

	document.querySelectorAll('.discount-input').forEach(input => {
		input.addEventListener('input', function () {
			const buttonId = 'btn-' + this.id.split('-')[1];
			const tipId = 'tip-' + this.id.split('-')[1];
			const button = document.getElementById(buttonId);
			const tip = document.getElementById(tipId);
	
			// Reset previous discount inputs if another discount input is being typed in
			document.querySelectorAll('.discount-input').forEach(otherInput => {
				if (otherInput !== this && otherInput.value.trim() !== '') {
					otherInput.value = '';
					document.getElementById('btn-' + otherInput.id.split('-')[1]).setAttribute('disabled', true);
					document.getElementById('tip-' + otherInput.id.split('-')[1]).style.display = 'none';
				}
			});
	
			// Enable/Disable button and show tip
			if (this.value.trim() !== '') {
				button.removeAttribute('disabled');
				tip.style.display = 'inline';
				tip.textContent = this.getAttribute('data-tip');
			} else {
				button.setAttribute('disabled', true);
				tip.style.display = 'none';
			}
		});
	});
	
	
	// Check if the page is being loaded for the first time
	if (performance.navigation.type === 1) {
		window.location.href = "{% url 'Amusement_Park:Products' %}";
	}

	let isDiscountApplied = false;

	// Function to apply discount
	function applyDiscount() {
		const discountInput = document.getElementById('discount-amount');
		const discountValue = parseFloat(discountInput.value);  // Convert input to number
		const totalPrice = parseFloat(document.getElementById('item-total-price').innerText.replace(/,/g, ''));  // Get total price
		const taxAmount = parseFloat(document.getElementById('tax-amount').innerText.replace(/,/g, ''));  // Get tax amount
		const maxDiscount = totalPrice + taxAmount;  // Calculate maximum allowed discount

		if (isNaN(discountValue) || discountValue <= 0) {
			Swal.fire({
				title: 'خطا!',
				text: 'لطفاً یک مقدار معتبر برای تخفیف وارد کنید.',
				icon: 'error',
				confirmButtonText: 'باشه'
			});
			return;
		}

		if (discountValue > maxDiscount) {
			Swal.fire({
				title: 'خطا!',
				text: `حداکثر مقدار تخفیف قابل اعمال ${maxDiscount.toLocaleString()} ریال است.`,
				icon: 'error',
				confirmButtonText: 'باشه'
			});
			return;
		}

		// Update discount display
		document.getElementById('discount-display').innerText = discountValue.toLocaleString() + ' ریال';

		// Show success notification
		Swal.fire({
			title: 'تخفیف اعمال شد!',
			text: `تخفیف ${discountValue.toLocaleString()} ریال با موفقیت اعمال شد.`,
			icon: 'success',
			confirmButtonText: 'باشه'
		});
		    // Set discount applied flag
    			isDiscountApplied = true;
				updateFinalPrice();
	}

	// Add event listener to the discount button
	document.getElementById('btn-amount').addEventListener('click', applyDiscount);

	// Enable/disable discount button based on input
	document.getElementById('discount-amount').addEventListener('input', function() {
		const discountButton = document.getElementById('btn-amount');
		if (this.value.trim() !== '') {
			discountButton.removeAttribute('disabled');
		} else {
			discountButton.setAttribute('disabled', true);
		}
	});


	// Function to apply percentage discount
	function applyPercentageDiscount() {
		const discountPercentInput = document.getElementById('discount-percent');
		const discountPercentValue = parseFloat(discountPercentInput.value);  // Convert input to number
		const totalPrice = parseFloat(document.getElementById('item-total-price').innerText.replace(/,/g, ''));  // Get total price
		const taxAmount = parseFloat(document.getElementById('tax-amount').innerText.replace(/,/g, ''));  // Get tax amount
		const totalAmount = totalPrice + taxAmount;  // Calculate total amount (price + tax)

		// Validate input
		if (isNaN(discountPercentValue) || discountPercentValue < 1 || discountPercentValue > 100) {
			Swal.fire({
				title: 'خطا!',
				text: 'لطفاً یک درصد معتبر بین ۱ تا ۱۰۰ وارد کنید.',
				icon: 'error',
				confirmButtonText: 'باشه'
			});
			return;
		}

		// Calculate discount amount
		const discountAmount = (totalAmount / 100) * discountPercentValue;

		// Update discount display
		document.getElementById('discount-display').innerText = discountAmount.toLocaleString() + ' ریال';

		// Show success notification
		Swal.fire({
			title: 'تخفیف اعمال شد!',
			text: `تخفیف ${discountPercentValue}% (${discountAmount.toLocaleString()} ریال) با موفقیت اعمال شد.`,
			icon: 'success',
			confirmButtonText: 'باشه'
		});
		    // Set discount applied flag
    			isDiscountApplied = true;
				updateFinalPrice();
	}

	// Add event listener to the percentage discount button
	document.getElementById('btn-percent').addEventListener('click', applyPercentageDiscount);

	// Enable/disable percentage discount button based on input
	document.getElementById('discount-percent').addEventListener('input', function() {
		const discountPercentButton = document.getElementById('btn-percent');
		if (this.value.trim() !== '') {
			discountPercentButton.removeAttribute('disabled');
		} else {
			discountPercentButton.setAttribute('disabled', true);
		}
	});


	// Function to apply discount code
	function applyDiscountCode() {
		const discountCodeInput = document.getElementById('discount-code');
		const discountCode = discountCodeInput.value.trim().toLowerCase();  // Normalize the input

		if (!discountCode) {
			Swal.fire({
				title: 'خطا!',
				text: 'لطفاً یک کد تخفیف وارد کنید.',
				icon: 'error',
				confirmButtonText: 'باشه'
			});
			return;
		}

		// Fetch discount code details from the server
		fetch(`{% url 'Amusement_Park:check_discount_code' %}?code=${discountCode}`)
		.then(response => response.json())
		.then(data => {
			if (data.success) {
				const totalPrice = parseFloat(document.getElementById('item-total-price').innerText.replace(/,/g, ''));  // Get total price
				const taxAmount = parseFloat(document.getElementById('tax-amount').innerText.replace(/,/g, ''));  // Get tax amount
				const totalAmount = totalPrice + taxAmount;  // Calculate total amount (price + tax)
				const discountAmount = (totalAmount / 100) * data.percent;  // Calculate discount amount

				// Update discount display
				document.getElementById('discount-display').innerText = discountAmount.toLocaleString() + ' ریال';

				// Show success notification
				Swal.fire({
					title: 'تخفیف اعمال شد!',
					text: data.message,
					icon: 'success',
					confirmButtonText: 'باشه'
				});
				    // Set discount applied flag
    			isDiscountApplied = true;
				updateFinalPrice();
			} else {
				// Show error notification
				Swal.fire({
					title: 'خطا!',
					text: data.message,
					icon: 'error',
					confirmButtonText: 'باشه'
				});
			}
		})
		.catch(error => {
			console.log('Error:', error);
		});
	}

	// Add event listener to the discount code button
	document.getElementById('btn-code').addEventListener('click', applyDiscountCode);

	// Enable/disable discount code button based on input
	document.getElementById('discount-code').addEventListener('input', function() {
		const discountCodeButton = document.getElementById('btn-code');
		if (this.value.trim() !== '') {
			discountCodeButton.removeAttribute('disabled');
		} else {
			discountCodeButton.setAttribute('disabled', true);
		}
	});

	// Restrict input to lowercase English letters
	document.getElementById('discount-code').addEventListener('input', function() {
		this.value = this.value.toLowerCase().replace(/[^a-z0-9]/g, '');
	});	


	document.addEventListener('DOMContentLoaded', function() {
		fetchTotalPrice();
		updateFinalPrice();  // Update final price on page load
	});


    const phoneInput = document.getElementById('phoneInput');
    const applyButton = document.getElementById('applyButton');
    phoneInput.addEventListener('input', function () {
        if (phoneInput.value.length === 11) {
            applyButton.disabled = false; 
        } else {
            applyButton.disabled = true;
        }
    });	




	const birthDay = document.getElementById('birthDay');
    const birthMonth = document.getElementById('birthMonth');

    birthMonth.addEventListener('change', function () {
        const selectedDay = parseInt(birthDay.value, 10);
        const selectedMonth = parseInt(birthMonth.value, 10); 

        if (selectedMonth >= 7 && selectedDay === 31) {
            birthDay.value = 30; 
        }
    });

    birthDay.addEventListener('change', function () {
        const selectedDay = parseInt(birthDay.value, 10); 
        const selectedMonth = parseInt(birthMonth.value, 10); 

        if (selectedMonth >= 7 && selectedDay === 31) {
            birthDay.value = 30;
        }
    });	


	document.getElementById('applyButton').addEventListener('click', function () {
		const phoneInput = document.getElementById('phoneInput');
		const phone = phoneInput.value;
	
		fetch(`/Amusement_Park/search-customer/?phone=${phone}`)
			.then(response => response.json())
			.then(data => {
				if (data.exists) {
					document.getElementById('firstName').value = data.first_name || '';
					document.getElementById('lastName').value = data.last_name || '';
	
					if (data.date_of_birth) {
						const dateParts = data.date_of_birth.split('-');
						document.getElementById('birthYear').value = dateParts[0];
						document.getElementById('birthMonth').value = dateParts[1];
						document.getElementById('birthDay').value = dateParts[2];
					}
	
					document.getElementById('firstName').setAttribute('disabled', true);
					document.getElementById('lastName').setAttribute('disabled', true);
					document.getElementById('birthYear').setAttribute('disabled', true);
					document.getElementById('gender').setAttribute('disabled', true);
					document.getElementById('city').setAttribute('disabled', true);
					document.getElementById('country').setAttribute('disabled', true);
					document.getElementById('birthMonth').setAttribute('disabled', true);
					document.getElementById('birthDay').setAttribute('disabled', true);
					document.querySelector('button[type="submit"]').setAttribute('disabled', true);
	
					phoneInput.setAttribute('disabled', true);
					document.getElementById('applyButton').setAttribute('disabled', true);
	
					Swal.fire({
						icon: 'info',
						title: 'کاربر با موفقیت یافت شد',
						text: 'خوش حال هستیم که ما شریک شادی شما هستیم.',
					});
				} else {
					document.getElementById('firstName').removeAttribute('disabled');
					document.getElementById('lastName').removeAttribute('disabled');
					document.getElementById('birthYear').removeAttribute('disabled');
					document.getElementById('gender').removeAttribute('disabled');
					document.getElementById('city').removeAttribute('disabled');
					document.getElementById('country').removeAttribute('disabled');
					document.getElementById('birthMonth').removeAttribute('disabled');
					document.getElementById('birthDay').removeAttribute('disabled');
					document.querySelector('button[type="submit"]').removeAttribute('disabled');
	
					phoneInput.setAttribute('disabled', true);
					document.getElementById('applyButton').setAttribute('disabled', true);
	
					Swal.fire({
						icon: 'success',
						title: 'کاربر جدید',
						text: 'لطفاً اطلاعات خود را وارد کنید.',
					});
				}
			})
			.catch(error => {
				console.error('Error:', error);
				Swal.fire({
					icon: 'error',
					title: 'خطا',
					text: 'مشکلی در ارتباط با سرور به وجود آمد.',
				});
			});
	});
	
	document.getElementById('phoneInput').addEventListener('input', function () {
		const phone = this.value;
		const applyButton = document.getElementById('applyButton');
	
		if (phone.length === 11 && phone.startsWith('09')) {
			applyButton.removeAttribute('disabled');
		} else {
			applyButton.setAttribute('disabled', true);
		}
	});
	
	document.querySelector('form').addEventListener('submit', function (e) {
		e.preventDefault(); 
	
		const formData = new FormData(this);
	
		if (document.getElementById('phoneInput').disabled) {
			formData.append('phone', document.getElementById('phoneInput').value);
		}
	
		const birthYear = formData.get('birthYear');
		const birthMonth = formData.get('birthMonth');
		const birthDay = formData.get('birthDay');
		const date_of_birth = `${birthYear}-${birthMonth.padStart(2, '0')}-${birthDay.padStart(2, '0')}`;
	
		formData.append('date_of_birth', date_of_birth);
	
		for (let [key, value] of formData.entries()) {
			console.log(key, value);
		}
	
		fetch(this.action, {
			method: 'POST',
			body: formData,
			headers: {
				'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
			},
		})
		.then(response => response.json())
		.then(data => {
			if (data.success) {
				document.getElementById('firstName').setAttribute('disabled', true);
				document.getElementById('lastName').setAttribute('disabled', true);
				document.getElementById('birthYear').setAttribute('disabled', true);
				document.getElementById('birthMonth').setAttribute('disabled', true);
				document.getElementById('birthDay').setAttribute('disabled', true);
				document.querySelector('button[type="submit"]').setAttribute('disabled', true);
	
				Swal.fire({
					icon: 'success',
					title: 'موفقیت‌آمیز',
					text: data.message || 'اطلاعات کاربر با موفقیت ذخیره شد.',
				});
			} else {
				Swal.fire({
					icon: 'error',
					title: 'خطا',
					text: data.message || 'مشکلی در ذخیره اطلاعات به وجود آمد.',
				});
			}
		})
		.catch(error => {
			console.error('Error:', error);
			Swal.fire({
				icon: 'error',
				title: 'خطا',
				text: 'مشکلی در ارتباط با سرور به وجود آمد.',
			});
		});
	});
	
	
	function getTransactionType() {
		const isCardReaderOpen = document.getElementById('collapse-card-reader').classList.contains('show');
		const isCashOpen = document.getElementById('collapse-cash').classList.contains('show');
		const isCombinedOpen = document.getElementById('collapse-combined').classList.contains('show');
	
		if (isCardReaderOpen) {
			return 'pc'; 
		} else if (isCashOpen) {
			return 'cash'; 
		} else if (isCombinedOpen) {
			return 'mix';
		} else {
			return 'pc'; 
		}
	}




	document.getElementById('btn-code').addEventListener('click', function () {
		const discountCode = document.getElementById('discount-code').value;
	
		fetch(`{% url 'Amusement_Park:check_discount_code' %}?code=${discountCode}`)
			.then(response => response.json())
			.then(data => {
				if (data.success) {
					const totalPrice = parseFloat(document.getElementById('item-total-price').innerText.replace(/[^0-9.-]+/g, ""));
					const taxAmount = parseFloat(document.getElementById('tax-amount').innerText.replace(/[^0-9.-]+/g, ""));
					const totalWithTax = totalPrice + taxAmount;  
	
					const discountAmount = (totalWithTax / 100) * data.percent; 
					document.getElementById('discount-display').innerText = discountAmount.toLocaleString() + ' ریال';
	
					updateFinalPrice();  
				}
			})
			.catch(error => {
				console.error('Error:', error);
				alert('خطا در ارتباط با سرور.');
			});
	});


{% comment %} PcPos JS Setting Start {% endcomment %}
function check1() {
	var checkBox1 = document.getElementById("chBox1");
		var checkBox2 = document.getElementById("chBox2");
		if (checkBox1.checked == true){
			checkBox2.checked = false;
		}
	}
	
	function check2() {
		var checkBox1 = document.getElementById("chBox1");
		var checkBox2 = document.getElementById("chBox2");
		if (checkBox2.checked == true){
			checkBox1.checked = false;
		}
	}
	
	var doPCPOS = function(){

		const amountValue = parseFloat($('#amount').val().replace(/,/g, '')) || 0;
		const isCashSale = document.getElementById('collapse-cash').classList.contains('show');
		
		if (amountValue <= 0 || isCashSale) {
			return;
		}		
		
		var req_params = new Object();
		req_params.PR = $('#pr_code').val();
		req_params.AM = $('#amount').val();
		req_params.CU = $('#currency').val();
		if (($('#r_cardholder').val().length > 0)) { req_params.R1 = $('#r_cardholder').val(); }
		if (($('#r3').val().length > 0)) { req_params.R3 = $('#r3').val(); }
		if (($('#r5').val().length > 0)) { req_params.R5 = $('#r5').val(); }
		if (($('#r7').val().length > 0)) { req_params.R7 = $('#r7').val(); }
		if (($('#r9').val().length > 0)) { req_params.R9 = $('#r9').val(); }
		
		if (($('#r4').val().length > 0)) { req_params.R4 = $('#r4').val(); }
		if (($('#r6').val().length > 0)) { req_params.R6 = $('#r6').val(); }
		if (($('#r8').val().length > 0)) { req_params.R8 = $('#r8').val(); }
		
		if (($('#r_merchant').val().length > 0))   { req_params.R2 = $('#r_merchant').val();   }
		if (($('#t_cardholder').val().length > 0)) { req_params.T1 = $('#t_cardholder').val(); }
		if (($('#t_merchant').val().length > 0))   { req_params.T2 = $('#t_merchant').val();   }
		var checkBox1 = document.getElementById("chBox1");
		if (checkBox1.checked == true){
			if (($('#WareHoff1').val().length > 0)  && ($('#WareHoff2').val().length > 0)){
				req_params.SV = $('#WareHoff1').val();
				req_params.SG = $('#WareHoff2').val();
			}
		}
		else{
			var checkBox2 = document.getElementById("chBox2");
			if (checkBox2.checked == true){
				if (($('#Amount1').val().length > 0) && ($('#IBAN1').val().length > 0) && ($('#ID1').val().length > 0)){
					req_params.A1 = $('#Amount1').val();
					req_params.D1 = $('#ID1').val();
					req_params.I1 = $('#IBAN1').val();
				}
				if (($('#Amount2').val().length > 0)  
				&& ($('#IBAN2').val().length > 0) 
				&& ($('#ID2').val().length > 0)){
					req_params.A2 = $('#Amount2').val();
					req_params.D2 = $('#ID2').val();
					req_params.I2 = $('#IBAN2').val();
				}
				if (($('#Amount3').val().length > 0)  
				&& ($('#IBAN3').val().length > 0) 
				&& ($('#ID3').val().length > 0)){
					req_params.A3 = $('#Amount3').val();
					req_params.D3 = $('#ID3').val();
					req_params.I3 = $('#IBAN3').val();
				}
				if (($('#Amount4').val().length > 0)  
				&& ($('#IBAN4').val().length > 0) 
				&& ($('#ID4').val().length > 0)){
					req_params.A4 = $('#Amount4').val();
					req_params.D4 = $('#ID4').val();
					req_params.I4 = $('#IBAN4').val();
				}
			}
		}
		req_params.AD = "";
		req_params.PD = "1";
		req_params.ST = $('#settelment').val().split(",");
		req_params.AV = $('#key_value').val().split(",");
		
		
		$('#result').empty();
		$.ajax({
			type: "POST",
			url: $('#pcpos_url').val(),				
			data: JSON.stringify(req_params),
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			timeout:120*1000,
			success: doSuccess,
			failure: function(errMsg) {
				alert(errMsg);
			}
		});
		
	}
	
	var doSuccess = function(data){
		$('#result').empty();
		$('#result').append(JSON.stringify(data,null, "\t"));
	}
	
	$('#search').click(doPCPOS);
{% comment %} PcPos JS Setting Finish {% endcomment %}

{% comment %} PcPos _ move number to hidden input Start {% endcomment %}
function updateFinalPrice() {
			const totalPrice = parseFloat(document.getElementById('item-total-price').innerText.replace(/,/g, ''));
			const taxAmount = parseFloat(document.getElementById('tax-amount').innerText.replace(/,/g, ''));
			const discountAmount = parseFloat(document.getElementById('discount-display').innerText.replace(/,/g, ''));
			
			const finalPrice = totalPrice + taxAmount - discountAmount;
			
			const finalPriceElement = document.getElementById('final-price');
			finalPriceElement.innerText = finalPrice.toLocaleString() + ' ریال';
			
			// Set this final price to the hidden input with id="amount"
			const hiddenAmountInput = document.getElementById('amount');
			if (hiddenAmountInput) {
				hiddenAmountInput.value = finalPrice;
			}
			
			return finalPrice;
		}
{% comment %} PcPos _ move number to hidden input Finish {% endcomment %}

{% comment %} PcPos _ move number correctly to hidden input Start {% endcomment %}
document.addEventListener('DOMContentLoaded', function() {
	const amountInput       = document.getElementById('amount');
	const cashInput         = document.getElementById('cash-amount');
	const cardInput         = document.getElementById('card-amount');
	const applyButton       = document.getElementById('apply-button');
	const resetButton       = document.getElementById('reset-button');
	const collapseCard      = document.getElementById('collapse-card-reader');
	const collapseCombined  = document.getElementById('collapse-combined');
	const collapseCash      = document.getElementById('collapse-cash');
	
	collapseCard.addEventListener('shown.bs.collapse', () => {
		const final = updateFinalPrice();
		amountInput.value = final;
	});
	
			collapseCombined.addEventListener('shown.bs.collapse', () => {
				// reset inputs & buttons
				cashInput.value = '';
				cardInput.value = '';
				applyButton.disabled = true;
				resetButton.disabled = true;
				amountInput.value = 0;
			});
			
			collapseCash.addEventListener('shown.bs.collapse', () => {
				amountInput.value = 0;
			});
			
			// live‐sync in mix if they type in card‐amount
			cardInput.addEventListener('input', () => {
				if (collapseCombined.classList.contains('show')) {
					const cardVal = parseFloat(cardInput.value.replace(/,/g, '')) || 0;
				amountInput.value = cardVal;
				// enable apply if either field has a valid number
				applyButton.disabled = (cardVal === 0 && (parseFloat(cashInput.value.replace(/,/g,'')) || 0) === 0);
			}
		});
		
		cashInput.addEventListener('input', () => {
			if (collapseCombined.classList.contains('show')) {
				// enable apply when they start typing
				const cashVal = parseFloat(cashInput.value.replace(/,/g,'')) || 0;
				applyButton.disabled = (cashVal === 0 && (parseFloat(cardInput.value.replace(/,/g,'')) || 0) === 0);
			  }
			});
		  
			// 4) on Apply in mix, always compute and mirror the CARD side:
			applyButton.addEventListener('click', function() {
			  const finalPrice  = updateFinalPrice();
			  const cashAmount  = parseFloat(cashInput.value.replace(/,/g, '')) || 0;
			  const cardAmount  = parseFloat(cardInput.value.replace(/,/g, '')) || 0;
		  
			  if (cashAmount > 0) {
				if (cashAmount > finalPrice) {
				  Swal.fire({ title:'خطا', text:'مقدار نقدی نمی‌تواند بیشتر از قیمت نهایی باشد.', icon:'error', confirmButtonText:'باشه' });
				  return;
				}
				cardInput.value = (finalPrice - cashAmount).toLocaleString();
			}
			else if (cardAmount > 0) {
				if (cardAmount > finalPrice) {
					Swal.fire({ title:'خطا', text:'مقدار کارتخوان نمی‌تواند بیشتر از قیمت نهایی باشد.', icon:'error', confirmButtonText:'باشه' });
				  return;
				}
				cashInput.value = (finalPrice - cardAmount).toLocaleString();
			}
			
			// ← here’s the key: always mirror the computed CARD amount
			const newCardVal = parseFloat(cardInput.value.replace(/,/g, '')) || 0;
			amountInput.value = newCardVal;
			
			// disable inputs/buttons
			cashInput.disabled   = true;
			cardInput.disabled   = true;
			applyButton.disabled = true;
			resetButton.disabled = false;
			});
			
			// 5) Reset button returns everything to start
			resetButton.addEventListener('click', function() {
				cashInput.disabled = false;
				cardInput.disabled = false;
				cashInput.value    = '';
			  cardInput.value    = '';
			  amountInput.value  = 0;
			  applyButton.disabled = true;
			  resetButton.disabled = true;
			});
		});
{% comment %} PcPos _ move number correctly to hidden input Finish {% endcomment %}

{% comment %} PcPos _ For save the bill correctly Start  {% endcomment %}
document.addEventListener('DOMContentLoaded', function() {
	const cashInput = document.getElementById('cash-amount');
	const cardInput = document.getElementById('card-amount');
	const applyButton = document.getElementById('apply-button');
	const resetButton = document.getElementById('reset-button');
	const finalPriceElement = document.getElementById('final-price');
	const payButton = document.getElementById('search');

	function updateFinalPrice() {
		const totalPrice = parseFloat(document.getElementById('item-total-price').innerText.replace(/,/g, ''));
		const taxAmount = parseFloat(document.getElementById('tax-amount').innerText.replace(/,/g, ''));
		const discountAmount = parseFloat(document.getElementById('discount-display').innerText.replace(/,/g, ''));
		const finalPrice = totalPrice + taxAmount - discountAmount;
		finalPriceElement.innerText = finalPrice.toLocaleString() + ' ریال';
		return finalPrice;
	}

	function resetCombinedFields() {
		cashInput.value = '';
		cardInput.value = '';
		cashInput.disabled = false;
		cardInput.disabled = false;
		applyButton.disabled = true;
		resetButton.disabled = true;
	}

	function validateInput(input, finalPrice) {
		const value = parseFloat(input.value.replace(/,/g, '')) || 0;
		if (value > finalPrice) {
			Swal.fire({
				title: 'خطا',
				text: 'مقدار وارد شده نمی‌تواند بیشتر از قیمت نهایی باشد.',
				icon: 'error',
				confirmButtonText: 'باشه'
			});
			input.value = '';
			applyButton.disabled = true;
			return false;
		}
		return true;
	}

	function disableOtherInput(currentInput, otherInput, finalPrice) {
		if (currentInput.value.trim() !== '') {
			if (validateInput(currentInput, finalPrice)) {
				otherInput.disabled = true;
				applyButton.disabled = false;
			}
		} else {
			otherInput.disabled = false;
			applyButton.disabled = true;
		}
	}

	cashInput.addEventListener('input', function() {
		const finalPrice = updateFinalPrice();
		disableOtherInput(cashInput, cardInput, finalPrice);
	});

	cardInput.addEventListener('input', function() {
		const finalPrice = updateFinalPrice();
		disableOtherInput(cardInput, cashInput, finalPrice);
	});

	applyButton.addEventListener('click', function() {
		const finalPrice = updateFinalPrice();
		const cashAmount = parseFloat(cashInput.value.replace(/,/g, '')) || 0;
		const cardAmount = parseFloat(cardInput.value.replace(/,/g, '')) || 0;

		if (cashAmount > 0) {
			if (cashAmount > finalPrice) {
				Swal.fire({
					title: 'خطا',
					text: 'مقدار نقدی نمی‌تواند بیشتر از قیمت نهایی باشد.',
					icon: 'error',
					confirmButtonText: 'باشه'
				});
				return;
			}
			cardInput.value = (finalPrice - cashAmount).toLocaleString();
		} else if (cardAmount > 0) {
			if (cardAmount > finalPrice) {
				Swal.fire({
					title: 'خطا',
					text: 'مقدار کارتخوان نمی‌تواند بیشتر از قیمت نهایی باشد.',
					icon: 'error',
					confirmButtonText: 'باشه'
				});
				return;
			}
			cashInput.value = (finalPrice - cardAmount).toLocaleString();
		}

		cashInput.disabled = true;
		cardInput.disabled = true;

		applyButton.disabled = true;
		resetButton.disabled = false;
	});

	resetButton.addEventListener('click', function() {
		resetCombinedFields();
	});

	const cardReaderIP = localStorage.getItem('cardReaderIP') || '192.168.1.100';
	const cardReaderPort = localStorage.getItem('cardReaderPort') || '8000';

	function getTransactionType() {
		const isCardReaderOpen = document.getElementById('collapse-card-reader').classList.contains('show');
		const isCashOpen = document.getElementById('collapse-cash').classList.contains('show');
		const isCombinedOpen = document.getElementById('collapse-combined').classList.contains('show');

		if (isCardReaderOpen) {
			return 'pc'; 
		} else if (isCashOpen) {
			return 'cash'; 
		} else if (isCombinedOpen) {
			return 'mix';
		} else {
			return 'pc'; 
		}
	}

	payButton.addEventListener('click', function (e) {
		e.preventDefault();

		const cashAmount = parseFloat(cashInput.value.replace(/,/g, '')) || 0;
		const cardAmountInput = parseFloat(cardInput.value.replace(/,/g, '')) || 0;

		const isCombinedPayment = document.getElementById('collapse-combined').classList.contains('show');
		const isCashPayment = document.getElementById('collapse-cash').classList.contains('show');
		const transactionType = getTransactionType();
		const finalPrice = updateFinalPrice();

		let cardPaymentAmount = 0;
		if (transactionType === 'pc') {
			cardPaymentAmount = finalPrice;
		} else if (transactionType === 'mix') {
			cardPaymentAmount = cardAmountInput;
		}

		if (isCombinedPayment) {
			if (cashAmount === 0 && cardAmountInput === 0) {
				Swal.fire({
					title: 'خطا',
					text: 'لطفاً ابتدا مشخص کنید چقدر از فروش ترکیبی شما نقد است و چقدر با دستگاه کارتخوان پرداخت می‌شود.',
					icon: 'error',
					confirmButtonText: 'باشه'
				});
				return;
			} else if (cashInput.disabled === false || cardInput.disabled === false) {
				Swal.fire({
					title: 'خطا',
					text: 'لطفاً دکمه "اعمال" را بزنید تا مبالغ نقدی و کارتخوان تأیید شوند.',
					icon: 'error',
					confirmButtonText: 'باشه'
				});
				return;
			}
		}

		if (isCashPayment) {
			Swal.fire({
				title: 'تأیید فروش نقدی',
				text: 'آیا مطمئن هستید که این خرید کاملاً نقدی است؟',
				icon: 'question',
				showCancelButton: true,
				confirmButtonText: 'بله',
				cancelButtonText: 'خیر'
			}).then((result) => {
				if (result.isConfirmed) {
					proceedWithPayment();
				}
			});
		} else {
			proceedWithPayment();
		}

		function proceedWithPayment() {

			if (transactionType === 'pc' || (transactionType === 'mix' && cardPaymentAmount > 0)) {
				Swal.fire({
					title: 'پرداخت از طریق دستگاه کارتخوان...',
					allowOutsideClick: false,
					didOpen: () => { Swal.showLoading(); }
				});

				const formData = new URLSearchParams();
				formData.append('payment', cardPaymentAmount);
				formData.append('ip', cardReaderIP);
				formData.append('port', cardReaderPort);

				fetch('{% url "Amusement_Park:test_payment" %}', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/x-www-form-urlencoded',
						'X-CSRFToken': '{{ csrf_token }}'
					},
					body: formData
				})
				.then(response => response.json())
				.then(cardResponse => {
					if (cardResponse.status === 'success') {
						Swal.fire({
							icon: 'success',
							title: 'پرداخت کارتخوان موفق',
							text: cardResponse.message,
							timer: 1500,
							showConfirmButton: false
						}).then(() => {
							submitPayment();
						});
					} else {
						Swal.fire({
							icon: 'error',
							title: 'خطا در پرداخت کارتخوان',
							text: cardResponse.message,
							confirmButtonText: 'باشه'
						});
					}
				})
				.catch(error => {
					console.error('Error in card payment:', error);
					Swal.fire({
						icon: 'error',
						title: 'خطا در ارتباط با دستگاه کارتخوان',
						text: 'خطا در ارتباط با دستگاه کارتخوان.',
						confirmButtonText: 'باشه'
					});
				});
			} else {
				submitPayment();
			}
		}

		function submitPayment() {
			const phone = document.getElementById('phoneInput').value;
			const firstName = document.getElementById('firstName').value;
			const lastName = document.getElementById('lastName').value;
			const birthYear = document.getElementById('birthYear').value;
			const birthMonth = document.getElementById('birthMonth').value;
			const birthDay = document.getElementById('birthDay').value;

			const customerData = phone ? {
				phone: phone,
				firstName: firstName || null,
				lastName: lastName || null,
				birthYear: birthYear || null,
				birthMonth: birthMonth || null,
				birthDay: birthDay || null,
			} : null;

			const cartItems = [];
			document.querySelectorAll('[data-ticket-product-id]').forEach(item => {
				const productId = item.getAttribute('data-ticket-product-id');
				const quantity = item.querySelector('.counter').innerText;
				cartItems.push({ product_id: productId, quantity: parseInt(quantity) });
			});

			const transactionData = {
				type: getTransactionType(), 
				discount_code: document.getElementById('discount-code').value || null, 
				discount_amount: parseFloat(document.getElementById('discount-display').innerText.replace(/[^0-9.-]+/g, "")) || 0,
				mix_pc: cardInput ? parseFloat(cardInput.value.replace(/,/g, '')) : null,
				mix_cash: cashInput ? parseFloat(cashInput.value.replace(/,/g, '')) : null,
			};

			Swal.fire({
				title: 'در حال ثبت تراکنش...',
				allowOutsideClick: false,
				didOpen: () => { Swal.showLoading(); }
			});

			fetch('{% url "Amusement_Park:submit_pay" %}', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					'X-CSRFToken': '{{ csrf_token }}'
				},
				body: JSON.stringify({
					customer_data: customerData,
					cart_items: cartItems,
					transaction_data: transactionData,
				}),
			})
			.then(response => {
				if (!response.ok) {
					throw new Error('خطا در ارتباط با سرور.');
				}
				return response.json();
			})
			.then(data => {
				if (data.success) {
					Swal.fire({
						icon: 'success',
						title: 'موفقیت‌آمیز',
						text: 'پرداخت با موفقیت انجام شد.',
						confirmButtonText: 'باشه'
					}).then((result) => {
						if (result.isConfirmed) {
							window.location.href = `/Amusement_Park/tickets/${data.ticket_id}/print_qr/`;
						}
					});
				} else {
					Swal.fire({
						icon: 'error',
						title: 'خطا در پرداخت',
						text: 'خطا در پرداخت: ' + data.message,
						confirmButtonText: 'باشه'
					});
				}
			})
			.catch(error => {
				console.error('Error:', error);
				Swal.fire({
					icon: 'error',
					title: 'خطا در ارتباط با سرور',
					text: 'خطا در ارتباط با سرور.',
					confirmButtonText: 'باشه'
				});
			});
		}
	});


	document.querySelectorAll('.discount-input').forEach(input => {
		input.addEventListener('input', function() {
			resetCombinedFields();
		});
	});

	document.querySelectorAll('#btn-code, #btn-amount, #btn-percent').forEach(button => {
		button.addEventListener('click', function() {
			resetCombinedFields();
		});
	});

	const observer = new MutationObserver(function(mutations) {
		mutations.forEach(function(mutation) {
			if (mutation.attributeName === 'innerText' && mutation.target.id === 'final-price') {
				resetCombinedFields();
			}
		});
	});

	observer.observe(finalPriceElement, {
		attributes: true
	});
});



{% comment %} PcPos _ For save the bill correctly Finish {% endcomment %}
















	</script>
	{% endblock script %}
	
	
	